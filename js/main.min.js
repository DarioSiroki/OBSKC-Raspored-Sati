$(document).ready((function(){(window.localStorage.getItem("smjena")&&"js/A.json"===window.localStorage.getItem("smjena")||"js/B.json"===window.localStorage.getItem("smjena"))&&window.localStorage.setItem("smjena","");var e,t,n,o,a="https://raw.githubusercontent.com/DarioSiroki/OBSKC-Raspored-Sati/master/converter/data/json/",r=[];window.localStorage.getItem("verzije")&&!navigator.onLine?p(JSON.parse(window.localStorage.getItem("verzije"))):navigator.onLine?$.ajax({url:a+"versions.json",dataType:"json",async:!1,success:function(e){window.localStorage.setItem("verzije",JSON.stringify(e)),p(e)}}):alert("Spojite se na internet da bi se rasporedi mogli preuzeti, nakon što se preuzmu aplikacija radi bez internetske konekcije.");var i=["January","February","March","April","May","June","July","August","September","October","November","December"],c=["pon","uto","sri","cet","pet"],l=["7.45-8.30","8.35-9.20","9.25-10.10","10.25-11.10","11.15-12.00","12.05-12.50","12.55-13.40"],s=["13.45-14.30","14.35-15.20","15.25-16.10","16.25-17.10","17.15-18.00","18.05-18.50","18.55-19.40"];function p(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].substring(0,e[n].length-6));t=(t=t.filter((function(e,n){return t.indexOf(e)==n}))).sort((function(e,t){return(e=new Date(e))>(t=new Date(t))?-1:e<t?1:0}));for(n=0;n<t.length;n++){var a=new Date(t[n]+",2018"),r=new Date,i=new Date(t[n]+" "+(1900+r.getYear())).getTime()-(r.getTime()+2592e5);if(i<0&&i>-6912e5){o=t[n];a.getMonth();var c=n}$("#datum").append("<option value="+n+"> "+t[n].match(/\d/g).join("")+"."+(a.getMonth()+1)+". </option>")}$("select#datum").val(c)}function u(e){if("A/B"===e){var t=[];if(window.localStorage.getItem(o+"A")&&window.localStorage.getItem(o+"B"))return t[0]=JSON.parse(window.localStorage.getItem(o+"A")),t[1]=JSON.parse(window.localStorage.getItem(o+"B")),t;$.ajax({url:a+o+"A.json",dataType:"json",async:!1,success:function(e){t[0]=e,window.localStorage.setItem(o+"A",JSON.stringify(e))}}),$.ajax({url:a+o+"B.json",dataType:"json",async:!1,success:function(e){t[1]=e,window.localStorage.setItem(o+"B",JSON.stringify(e))}})}else{if(window.localStorage.getItem(o+e))return t=JSON.parse(window.localStorage.getItem(o+e));$.ajax({url:a+o+e+".json",dataType:"json",async:!1,success:function(n){t=n,window.localStorage.setItem(o+e,JSON.stringify(n))}})}return t}function g(){$("#tags").autocomplete({delay:0,source:function(e,t){var n=$.ui.autocomplete.escapeRegex(e.term),o=new RegExp("^"+n,"i");t($.grep(r,(function(e,t){return o.test(e)})))},minlength:0})}function d(){if("Učenik"==n)!function(e,t){r.length=0;for(var n=[],o=1;o<t-3;o++)for(var a=1;a<36;a++)"object"==typeof e[o][a]&&n.push(e[o][a].name);$.each(n,(function(e,t){-1===$.inArray(t,r)&&r.push(t)})),r=r.filter((function(e){return e.length<4})),g()}(e=u(t),e.length);else if("Profesor"==n)if("A/B"==t){(e=u(t)).length;!function(e){r.length=0;for(var t=[],n=0;n<e.length;n++)for(var o=1;o<e[n].length-3;o++)t.push(e[n][o][0]);var a=[];$.each(t,(function(e,n){a.push(t[e].replace(/ /g,"").replace(/-/g,""))}));var i=[];$.each(a,(function(e,n){-1===$.inArray(n,i)&&(i.push(n),r.push(t[e].replace(/-/g," ")))})),g()}(e)}else{var e;!function(e,t){r.length=0;for(var n=1;n<t-3;n++)r.push(e[n][0]);g()}(e=u(t),e.length)}}function h(e){return function(e){if("object"==typeof e&&e.hasOwnProperty("pattern")){var t="background-image: url(&img/"+e.pattern+".png&);font-weight:600;font-size: 20px;";return t.replace(/&/g,'"')}return""}(e)+function(e){return"object"==typeof e&&e.hasOwnProperty("bgColor")?"background-color:#"+e.bgColor+";font-weight:600;":""}(e)+function(e){return"object"==typeof e&&e.hasOwnProperty("fontColor")?(value="color:#"+e.fontColor+";",value):""}(e)}function f(){for(var e=0;e<c.length;e++)document.getElementById(c[e]).innerHTML=""}function m(t){t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.napomena?($("#napomena").html(t.A.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")):t.napomena?($("#napomena").html(t.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")),document.getElementById("info").innerHTML="Raspored za: <br>"+(t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.datum:t.datum)+",<br>"+e;var n=(new Date).getDay();(n>5||0==n)&&(n=1),$("#dezurni").html("<tbody>"+function(e){try{var t="";if(e.hasOwnProperty("A")&&e.hasOwnProperty("B"))for(var n=0;n<c.length;n++)t+="<tr><th>"+c[n].charAt(0).toUpperCase()+c[n].slice(1)+"</tr></th><tr><td><b>Prijepodne: </b>"+e.A.dezurni[n+1].name+(window.innerWidth<500?"<br>":"")+" <b>Poslijepodne: </b>"+e.B.dezurni[n+1].name+"</tr></td>";else for(n=0;n<c.length;n++)t+="<tr><th>"+c[n].charAt(0).toUpperCase()+c[n].slice(1)+"</tr></th><tr><td>"+e.dezurni[n+1].name+"</tr></td>"}catch(e){}return t}(t)+"</tbody>"),$("#accordion").accordion({active:n-1}),$("p.inline").each((function(){var e=$(this).css(["background-color","color","pattern"]);"rgba(0, 0, 0, 0)"!==e["background-color"]&&"rgb(204, 255, 204)"!==e["background-color"]&&null!==e.pattern&&"rgb(51, 51, 51)"===e.color&&$(this).css("color","#FFFFFF")}))}function w(){var o,a;a=(o=u(t)).length,trajanje=function(e){return trajanje="PRIJE"===e.prijeposlije?l:s,trajanje}(o[0]),"Učenik"==n?function(t,n){f();let o=0,a=-999,r="";for(let l=1;l<40;l++){let s=!1;for(var i=1;i<n;i++){const n=t[i][l];if(n&&-1!=n.name.indexOf(e))if(s)r+=`/<p class='inline' style='${h(n)}'>${t[i][0]}</p>`;else{const e=n.sat<a;a=n.sat,e&&(document.getElementById(c[o++]).innerHTML=r,r=""),r+=`<th>${n.sat}.sat (${n.trajanje})</th><tr><td>`,r+=`<p class='inline' style='${h(n)}'>${t[i][0]}</p>`,s=!0}}r+="</td></tr>"}document.getElementById(c[o++]).innerHTML=r,m(t[0])}(o,a):"Profesor"==n&&"A/B"!=t?function(t,n){f();const o={pon:[],uto:[],sri:[],cet:[],pet:[]};t.forEach(((t,n)=>{if(0!==n&&-1!==t[0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,"")))for(let e=1;e<t.length;e++){const n=t[e];"object"==typeof n&&n.dan&&o[n.dan].push(n)}})),Object.keys(o).forEach((e=>{const t=o[e];let n="";t.forEach((e=>{n+=`\n          <th>${e.sat}.sat (${e.trajanje})</th>\n        </tr>\n        <tr>\n          <td>\n            <p class='inline' style='${h(e)}'>${e.name}</p>\n          </td>\n        </tr>`})),document.getElementById(e).innerHTML=n})),m(t[0])}(o):function(t){if(f(),"POSLIJE"===t[0][0].prijeposlije){var n=t[1];t[1]=t[0],t[0]=n}const o={pon:[],uto:[],sri:[],cet:[],pet:[]},a={pon:[],uto:[],sri:[],cet:[],pet:[]};t.forEach((t=>{const n="PRIJE"===t[0].prijeposlije;t.forEach(((t,r)=>{if(0!==r&&-1!==t[0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,"")))for(let e=1;e<t.length;e++){const r=t[e];"object"==typeof r&&r.dan&&(n?o[r.dan].push(r):a[r.dan].push(r))}}))})),Object.keys(o).forEach((e=>{const t=o[e],n=a[e];let r="";t.length>0&&(r+="<tr><th>PRIJEPODNE</th></tr><tr>",t.forEach((e=>{r+=`\n          <th>${e.sat}.sat (${e.trajanje})</th>\n        </tr>\n        <tr>\n          <td>\n            <p class='inline' style='${h(e)}'>${e.name}</p>\n          </td>\n        </tr>`}))),n.length>0&&(r+="<tr><th>POSLIJEPODNE</th></tr><tr>",n.forEach((e=>{r+=`\n          <th>${e.sat}.sat (${e.trajanje})</th>\n        </tr>\n        <tr>\n          <td>\n            <p class='inline' style='${h(e)}'>${e.name}</p>\n          </td>\n        </tr>`}))),document.getElementById(e).innerHTML=r})),m({A:t[0][0],B:t[1][0]})}(o)}$("#accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),e=window.localStorage.getItem("input"),t=window.localStorage.getItem("smjena"),n=window.localStorage.getItem("osoba"),e&&t&&""!==n&&w(),$("select").change((function(){var e=$("select option:selected").text().split(".")||[];o=i[parseInt(e[1])-1]+e[0].replace(/ /g,"");try{d()}catch(e){}})),$(".osoba").click((function(){$(".smjena").prop("disabled",!1),n=$(".osoba:checked").val()||[];try{d()}catch(e){}})),$(".smjena").click((function(){$("#tags").prop("disabled",!1),t=$(".smjena:checked").val()||[],d()})),$("#tags").click((function(){$(".en").prop("disabled",!1)})),$("#remember").click((function(){e=$("#tags").val().toUpperCase(),window.localStorage.setItem("input",e),window.localStorage.setItem("smjena",t),window.localStorage.setItem("osoba",n),w()}))}));