$(document).ready(function(){(window.localStorage.getItem("smjena")&&"js/A.json"===window.localStorage.getItem("smjena")||"js/B.json"===window.localStorage.getItem("smjena"))&&window.localStorage.setItem("smjena","");var e,t,n,r,a="https://raw.githubusercontent.com/DarioSiroki/OBSKC-Raspored-Sati/master/converter/data/json/",o=[];window.localStorage.getItem("verzije")?g(JSON.parse(window.localStorage.getItem("verzije"))):$.ajax({url:a+"versions.json",dataType:"json",async:!1,success:function(e){window.localStorage.setItem("verzije",JSON.stringify(e)),g(e)}});var c=["January","February","March","April","May","June","July","August","September","October","November","December"],l=["pon","uto","sri","cet","pet"],s=["7.45-8.30","8.35-9.20","9.25-10.10","10.25-11.10","11.15-12.00","12.05-12.50","12.55-13.40"],p=["13.45-14.30","14.35-15.20","15.25-16.10","16.25-17.10","17.15-18.00","18.05-18.50","18.55-19.40"];function g(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].substring(0,e[n].length-6));t=(t=t.filter(function(e,n){return t.indexOf(e)==n})).sort(function(e,t){return(e=new Date(e))>(t=new Date(t))?-1:e<t?1:0});for(n=0;n<t.length;n++){var a=new Date(t[n]),o=new Date,i=new Date(t[n]+" "+(1900+o.getYear())).getTime()-(o.getTime()+2592e5);i<0&&i>-6048e5&&(r=t[n]),$("#datum").append("<option> "+t[n].match(/\d/g).join("")+"."+(a.getMonth()+1)+". </option>")}}function u(e){if("A/B"===e){var t=[];if(window.localStorage.getItem(r+"A")&&window.localStorage.getItem(r+"B"))return t[0]=JSON.parse(window.localStorage.getItem(r+"A")),t[1]=JSON.parse(window.localStorage.getItem(r+"B")),t;$.ajax({url:a+r+"A.json",dataType:"json",async:!1,success:function(e){t[0]=e,window.localStorage.setItem(r+"A",JSON.stringify(e))}}),$.ajax({url:a+r+"B.json",dataType:"json",async:!1,success:function(e){t[1]=e,window.localStorage.setItem(r+"B",JSON.stringify(e))}})}else{if(window.localStorage.getItem(r+e))return t=JSON.parse(window.localStorage.getItem(r+e));$.ajax({url:a+r+e+".json",dataType:"json",async:!1,success:function(n){t=n,window.localStorage.setItem(r+e,JSON.stringify(n))}})}return t}function d(){$("#tags").autocomplete({delay:0,source:function(e,t){var n=$.ui.autocomplete.escapeRegex(e.term),r=new RegExp("^"+n,"i");t($.grep(o,function(e,t){return r.test(e)}))},minlength:0})}function f(){if("Učenik"==n)!function(e,t){o.length=0;for(var n=[],r=1;r<t-3;r++)for(var a=1;a<36;a++)"object"==typeof e[r][a]&&n.push(e[r][a].name);$.each(n,function(e,t){-1===$.inArray(t,o)&&o.push(t)}),o=o.filter(function(e){return e.length<4}),d()}(e=u(t),e.length);else if("Profesor"==n)if("A/B"==t){(e=u(t)).length;!function(e){o.length=0;for(var t=[],n=0;n<e.length;n++)for(var r=1;r<e[n].length-3;r++)t.push(e[n][r][0]);var a=[];$.each(t,function(e,n){a.push(t[e].replace(/ /g,"").replace(/-/g,""))});var i=[];$.each(a,function(e,n){-1===$.inArray(n,i)&&(i.push(n),o.push(t[e].replace(/-/g," ")))}),d()}(e)}else{var e;!function(e,t){o.length=0;for(var n=1;n<t-3;n++)o.push(e[n][0]);d()}(e=u(t),e.length)}}function m(e){return function(e){if("object"==typeof e&&e.hasOwnProperty("pattern")){var t="background-image: url(&img/"+e.pattern+".png&);font-weight:600;font-size: 20px;";return t=t.replace(/&/g,'"')}return""}(e)+("object"==typeof(n=e)&&n.hasOwnProperty("bgColor")?"background-color:#"+n.bgColor+";font-weight:600;":"")+("object"==typeof(t=e)&&t.hasOwnProperty("fontColor")?(value="color:#"+t.fontColor+";",value):"");var t,n}function h(){for(var e=0;e<l.length;e++)document.getElementById(l[e]).innerHTML=""}function w(t){t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.napomena?($("#napomena").html(t.A.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")):t.napomena?($("#napomena").html(t.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")),document.getElementById("info").innerHTML="Raspored za: <br>"+(t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.datum:t.datum)+",<br>"+e;var n=(new Date).getDay();(n>5||0==n)&&(n=1),$("#dezurni").html("<tbody>"+function(e){try{var t="";if(e.hasOwnProperty("A")&&e.hasOwnProperty("B"))for(var n=0;n<l.length;n++)t+="<tr><th>"+l[n].charAt(0).toUpperCase()+l[n].slice(1)+"</tr></th><tr><td><b>Prijepodne: </b>"+e.A.dezurni[n+1].name+(window.innerWidth<500?"<br>":"")+" <b>Poslijepodne: </b>"+e.B.dezurni[n+1].name+"</tr></td>";else for(n=0;n<l.length;n++)t+="<tr><th>"+l[n].charAt(0).toUpperCase()+l[n].slice(1)+"</tr></th><tr><td>"+e.dezurni[n+1].name+"</tr></td>"}catch(e){}return t}(t)+"</tbody>"),$("#accordion").accordion({active:n-1})}function j(){var r,a,o;a=(r=u(t)).length,trajanje=(o=r[0],trajanje="PRIJE"===o.prijeposlije?s:p,trajanje),"Učenik"==n?function(t,n){h();for(var r=-1,a=1;a<36;a+=7){for(var o="",i=a;i<a+7;i++){var c=0;o+="<th>"+(i-a+1)+".sat ("+trajanje[i-a]+")</th><tr>";for(var s=1;s<n;s++)-1!=String(t[s][i].name).indexOf(e)&&(0==c?(o+="<td>"+("object"==typeof t[s][i]?"<p class='inline' style='"+m(t[s][i])+"'>"+t[s][0]+"</p>":""),c++):o+="/"+("object"==typeof t[s][i]?"<p class='inline' style='"+m(t[s][i])+"'>"+t[s][0]+"</p>":""));o+="</td></tr>"}r++,document.getElementById(l[r]).innerHTML=o}w(t[0])}(r,a):"Profesor"==n&&"A/B"!=t?function(t,n){h();var r=-1;for(i=1;i<n;i++)if(-1!==t[i][0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,"")))for(var a=1;a<36;a+=7){var o="";for(ii=a;ii<a+7;ii++)o+="<tr><th>"+(ii-a+1)+".sat ("+trajanje[ii-a]+")</th></tr><tr><td>"+("object"==typeof t[i][ii]?"<p class='inline' style='"+m(t[i][ii])+"'>"+t[i][ii].name+"</p>":"")+"</td></tr>";r++,document.getElementById(l[r]).innerHTML=o}w(t[0])}(r,a):function(t){if(h(),"POSLIJE"===t[0][0].prijeposlije){var n=t[1];t[1]=t[0],t[0]=n}for(var r=-1,a=1;a<36;a+=7){for(var o="",i=0,c=0;c<t.length;c++){for(var g=1;g<t[c].length;g++)if(-1!==t[c][g][0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,""))){o+=0===i?"<tr><th>PRIJEPODNE</th></tr>":"<tr><th>POSLIJEPODNE</th></tr>";for(var u=a;u<a+7;u++)"object"==typeof t[c][g][u]?o+="<tr><th>"+(u-a+1)+".sat ("+(0===i?s[u-a]:p[u-a])+")</th></tr><tr><td>"+("object"==typeof t[c][g][u]?"<p class='inline' style='"+m(t[c][g][u])+"'>"+t[c][g][u].name+"</p>":"")+"</td></tr>":o+=""}i++}r++,document.getElementById(l[r]).innerHTML=o}w({A:t[0][0],B:t[1][0]})}(r)}$("#accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),e=window.localStorage.getItem("input"),t=window.localStorage.getItem("smjena"),n=window.localStorage.getItem("osoba"),e&&t&&""!==n&&j(),$("select").change(function(){var e=$("select option:selected").text().split(".")||[];r=c[parseInt(e[1])-1]+e[0].replace(/ /g,"");try{f()}catch(e){}}),$(".osoba").click(function(){$(".smjena").prop("disabled",!1),n=$(".osoba:checked").val()||[];try{f()}catch(e){}}),$(".smjena").click(function(){$("#tags").prop("disabled",!1),t=$(".smjena:checked").val()||[],f()}),$("#tags").click(function(){$(".en").prop("disabled",!1)}),$("#remember").click(function(){e=$("#tags").val().toUpperCase(),window.localStorage.setItem("input",e),window.localStorage.setItem("smjena",t),window.localStorage.setItem("osoba",n),j()})});