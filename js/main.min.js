$(document).ready(function(){(window.localStorage.getItem("smjena")&&"js/A.json"===window.localStorage.getItem("smjena")||"js/B.json"===window.localStorage.getItem("smjena"))&&window.localStorage.setItem("smjena","");var e,t,n,r,o="https://raw.githubusercontent.com/DarioSiroki/OBSKC-Raspored-Sati/master/converter/data/json/",a=[];window.localStorage.getItem("verzije")&&!navigator.onLine?p(JSON.parse(window.localStorage.getItem("verzije"))):navigator.onLine?$.ajax({url:o+"versions.json",dataType:"json",async:!1,success:function(e){window.localStorage.setItem("verzije",JSON.stringify(e)),p(e)}}):alert("Spojite se na internet da bi se rasporedi mogli preuzeti, nakon što se preuzmu aplikacija radi bez internetske konekcije.");var c=["January","February","March","April","May","June","July","August","September","October","November","December"],l=["pon","uto","sri","cet","pet"],s=["7.45-8.30","8.35-9.20","9.25-10.10","10.25-11.10","11.15-12.00","12.05-12.50","12.55-13.40"],g=["13.45-14.30","14.35-15.20","15.25-16.10","16.25-17.10","17.15-18.00","18.05-18.50","18.55-19.40"];function p(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n].substring(0,e[n].length-6));t=(t=t.filter(function(e,n){return t.indexOf(e)==n})).sort(function(e,t){return(e=new Date(e))>(t=new Date(t))?-1:e<t?1:0});for(n=0;n<t.length;n++){var o=new Date(t[n]+",2018"),a=new Date,i=new Date(t[n]+" "+(1900+a.getYear())).getTime()-(a.getTime()+2592e5);if(i<0&&i>-6048e5){r=t[n];o.getMonth();var c=n}$("#datum").append("<option value="+n+"> "+t[n].match(/\d/g).join("")+"."+(o.getMonth()+1)+". </option>")}$("select#datum").val(c)}function u(e){if("A/B"===e){var t=[];if(window.localStorage.getItem(r+"A")&&window.localStorage.getItem(r+"B"))return t[0]=JSON.parse(window.localStorage.getItem(r+"A")),t[1]=JSON.parse(window.localStorage.getItem(r+"B")),t;$.ajax({url:o+r+"A.json",dataType:"json",async:!1,success:function(e){t[0]=e,window.localStorage.setItem(r+"A",JSON.stringify(e))}}),$.ajax({url:o+r+"B.json",dataType:"json",async:!1,success:function(e){t[1]=e,window.localStorage.setItem(r+"B",JSON.stringify(e))}})}else{if(window.localStorage.getItem(r+e))return t=JSON.parse(window.localStorage.getItem(r+e));$.ajax({url:o+r+e+".json",dataType:"json",async:!1,success:function(n){t=n,window.localStorage.setItem(r+e,JSON.stringify(n))}})}return t}function d(){$("#tags").autocomplete({delay:0,source:function(e,t){var n=$.ui.autocomplete.escapeRegex(e.term),r=new RegExp("^"+n,"i");t($.grep(a,function(e,t){return r.test(e)}))},minlength:0})}function f(){if("Učenik"==n)!function(e,t){a.length=0;for(var n=[],r=1;r<t-3;r++)for(var o=1;o<36;o++)"object"==typeof e[r][o]&&n.push(e[r][o].name);$.each(n,function(e,t){-1===$.inArray(t,a)&&a.push(t)}),a=a.filter(function(e){return e.length<4}),d()}(e=u(t),e.length);else if("Profesor"==n)if("A/B"==t){(e=u(t)).length;!function(e){a.length=0;for(var t=[],n=0;n<e.length;n++)for(var r=1;r<e[n].length-3;r++)t.push(e[n][r][0]);var o=[];$.each(t,function(e,n){o.push(t[e].replace(/ /g,"").replace(/-/g,""))});var i=[];$.each(o,function(e,n){-1===$.inArray(n,i)&&(i.push(n),a.push(t[e].replace(/-/g," ")))}),d()}(e)}else{var e;!function(e,t){a.length=0;for(var n=1;n<t-3;n++)a.push(e[n][0]);d()}(e=u(t),e.length)}}function h(e){return function(e){if("object"==typeof e&&e.hasOwnProperty("pattern")){var t="background-image: url(&img/"+e.pattern+".png&);font-weight:600;font-size: 20px;";return t=t.replace(/&/g,'"')}return""}(e)+("object"==typeof(n=e)&&n.hasOwnProperty("bgColor")?"background-color:#"+n.bgColor+";font-weight:600;":"")+("object"==typeof(t=e)&&t.hasOwnProperty("fontColor")?(value="color:#"+t.fontColor+";",value):"");var t,n}function m(){for(var e=0;e<l.length;e++)document.getElementById(l[e]).innerHTML=""}function w(t){t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.napomena?($("#napomena").html(t.A.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")):t.napomena?($("#napomena").html(t.napomena),$("div.alert.alert-warning").show()):($("div.alert.alert-warning").hide(),$("#napomena").html("")),document.getElementById("info").innerHTML="Raspored za: <br>"+(t.hasOwnProperty("A")&&t.hasOwnProperty("B")?t.A.datum:t.datum)+",<br>"+e;var n=(new Date).getDay();(n>5||0==n)&&(n=1),$("#dezurni").html("<tbody>"+function(e){try{var t="";if(e.hasOwnProperty("A")&&e.hasOwnProperty("B"))for(var n=0;n<l.length;n++)t+="<tr><th>"+l[n].charAt(0).toUpperCase()+l[n].slice(1)+"</tr></th><tr><td><b>Prijepodne: </b>"+e.A.dezurni[n+1].name+(window.innerWidth<500?"<br>":"")+" <b>Poslijepodne: </b>"+e.B.dezurni[n+1].name+"</tr></td>";else for(n=0;n<l.length;n++)t+="<tr><th>"+l[n].charAt(0).toUpperCase()+l[n].slice(1)+"</tr></th><tr><td>"+e.dezurni[n+1].name+"</tr></td>"}catch(e){}return t}(t)+"</tbody>"),$("#accordion").accordion({active:n-1}),$("p.inline").each(function(){var e=$(this).css(["background-color","color","pattern"]);"rgba(0, 0, 0, 0)"!==e["background-color"]&&"rgb(204, 255, 204)"!==e["background-color"]&&null!==e.pattern&&"rgb(51, 51, 51)"===e.color&&$(this).css("color","#FFFFFF")})}function j(){var r,o,a;o=(r=u(t)).length,trajanje=(a=r[0],trajanje="PRIJE"===a.prijeposlije?s:g,trajanje),"Učenik"==n?function(t,n){m();for(var r=-1,o=1;o<36;o+=7){for(var a="",i=o;i<o+7;i++){var c=0;a+="<th>"+(i-o+1)+".sat ("+trajanje[i-o]+")</th><tr>";for(var s=1;s<n;s++)-1!=String(t[s][i].name).indexOf(e)&&(0==c?(a+="<td>"+("object"==typeof t[s][i]?"<p class='inline' style='"+h(t[s][i])+"'>"+t[s][0]+"</p>":""),c++):a+="/"+("object"==typeof t[s][i]?"<p class='inline' style='"+h(t[s][i])+"'>"+t[s][0]+"</p>":""));a+="</td></tr>"}r++,document.getElementById(l[r]).innerHTML=a}w(t[0])}(r,o):"Profesor"==n&&"A/B"!=t?function(t,n){m();var r=-1;for(i=1;i<n;i++)if(-1!==t[i][0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,"")))for(var o=1;o<36;o+=7){var a="";for(ii=o;ii<o+7;ii++)a+="<tr><th>"+(ii-o+1)+".sat ("+trajanje[ii-o]+")</th></tr><tr><td>"+("object"==typeof t[i][ii]?"<p class='inline' style='"+h(t[i][ii])+"'>"+t[i][ii].name+"</p>":"")+"</td></tr>";r++,document.getElementById(l[r]).innerHTML=a}w(t[0])}(r,o):function(t){if(m(),"POSLIJE"===t[0][0].prijeposlije){var n=t[1];t[1]=t[0],t[0]=n}for(var r=-1,o=1;o<36;o+=7){for(var a="",i=0,c=0;c<t.length;c++){for(var p=1;p<t[c].length;p++)if(-1!==t[c][p][0].toUpperCase().replace(/ /g,"").indexOf(e.replace(/ /g,""))){a+=0===i?"<tr><th>PRIJEPODNE</th></tr>":"<tr><th>POSLIJEPODNE</th></tr>";for(var u=o;u<o+7;u++)"object"==typeof t[c][p][u]?a+="<tr><th>"+(u-o+1)+".sat ("+(0===i?s[u-o]:g[u-o])+")</th></tr><tr><td>"+("object"==typeof t[c][p][u]?"<p class='inline' style='"+h(t[c][p][u])+"'>"+t[c][p][u].name+"</p>":"")+"</td></tr>":a+=""}i++}r++,document.getElementById(l[r]).innerHTML=a}w({A:t[0][0],B:t[1][0]})}(r)}$("#accordion").accordion({collapsible:!0,active:!1,heightStyle:"content"}),e=window.localStorage.getItem("input"),t=window.localStorage.getItem("smjena"),n=window.localStorage.getItem("osoba"),e&&t&&""!==n&&j(),$("select").change(function(){var e=$("select option:selected").text().split(".")||[];console.log(e),r=c[parseInt(e[1])-1]+e[0].replace(/ /g,"");try{f()}catch(e){}}),$(".osoba").click(function(){$(".smjena").prop("disabled",!1),n=$(".osoba:checked").val()||[];try{f()}catch(e){}}),$(".smjena").click(function(){$("#tags").prop("disabled",!1),t=$(".smjena:checked").val()||[],f()}),$("#tags").click(function(){$(".en").prop("disabled",!1)}),$("#remember").click(function(){e=$("#tags").val().toUpperCase(),window.localStorage.setItem("input",e),window.localStorage.setItem("smjena",t),window.localStorage.setItem("osoba",n),j()})});